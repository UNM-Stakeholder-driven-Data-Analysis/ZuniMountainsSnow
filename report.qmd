---
title: "The Effect of USFS Thinning on Snowpack Accumulation Potential in the Zuñi Mountains"
format: html
number-sections: true
editor: visual
author: Josh Lopez-Binder
bibliography: SnowPackReport.json
---

```{r echo=FALSE, include=FALSE}
source("./R_Scripts/00_Functions.R")
```

## Plain Language Summary

*Are the U.S Forest Service forest thinning projects affecting the snowpack accumulation potential in the Zuñi mountains of New Mexico?*

Snowpack is an important source of water for springs and forests in the Zuñi Mountains. The U.S. Forest Service conducts forest thinning projects in the mountains to improve the resilience of forests to frequent-fire patterns and climate change (). It is currently not understood how thinning projects in the Zuñi Mountains have affected the accumulation of snow in the forest.

Spatial snowpack data is unavailable at high enough resolutions to be useful, but high resolution tree cover data is available. Therefore, it is necessary to assess the *potential* for the forest to accumulate snow based on tree cover. Snow that lands directly on trees is melted and evaporated more rapidly than snow that lands on the ground. Similarly, snow that falls on ground far away from tree cover is melted or moved by the wind more rapidly than snow closer to tree cover. A previous study found that, on average, ground within 15 meters of tree cover retains the most snow [@broxton2015a]. Manual inspection of google earth imagery in the Zuñi Mountains suggests that bare ground to the north of tree cover accumulates snow, presumably because it is shaded during midday, when the sun's energy is the most intense. Combining these observations suggests that bare ground within 15m of tree cover, and to the north, is optimal for snowpack accumulation. We call this "optimal ground."

We hypothesize that thinning is reducing snowpack accumulation potential because it has the effect of creating more unshaded bare ground greater than 15 meters from tree cover.

The highest resolution tree-cover data currently available represents tree cover as a percentage within each 30meter square [@townshendjohna]. In order to asses if an area is optimal it is necessary to analyze data that shows the precise locations of tree cover and bare ground. To do this we simulated tree locations based on the percent-cover data. The resulting calculations showed that after a thinning project in 2014 the amount of optimal ground decreased.

TODO: decrease word count

## Introduction

Snowpack is an important source of water for springs and forests in the Zuñi Mountains. The U.S. Forest Service conducts forest thinning projects in the mountains to improve the resilience of forests to frequent-fire patterns and climate change [@reynolds2013]. It is currently not understood how those thinning projects affect the accumulation of snow in the forest. Spatial snowpack data is unavailable at high enough resolutions to be useful, but high resolution tree cover data is available. Therefore, it is necessary to assess the *potential* for the forest to accumulate snow based on tree-cover. Snow that lands directly on trees is melted and evaporated more rapidly than snow that lands on the ground. Similarly, snow that falls on ground far away from tree cover is melted or moved by the wind more rapidly than snow closer to tree cover.

## Prediction

We hypothesize that thinning is reducing snowpack accumulation potential because it has the effect of creating more bare ground that is exposed to the sun.

## Methods

#### Data Sources

The highest resolution tree-cover data currently available represents tree cover as a percentage at 30x30 meters resolution [@townshendjohn]. Values are the integers 0-100. Error for each cell is also provided, where the error is root mean squared error in units of percent cover [@sexton2016] (TODO: this is my best interpretation but I am not certain) This data includes tree-cover images for the years 2000, 2005, 2010, and 2015.

The US Forest Service provides a data set of all activities and their spatial extents for the southwest region, as well as data representing forest boundaries [@activiti]. The activity data used include the date completed, the project they were a part of, and the type of activity.

#### Choosing a Thinning Project Area

USFS activities were selected that a) occurred in the Zuñi Mountains, b) were between the years 2000 and 2015, and c) not completed anytime within the years 2000, 2005, 2010 and 2015. This was to ensure that the treatment did not partially affect a subset of a polygon for a particular year. Activities that were labeled "Thinning for hazardous fuel reduction" were selected and grouped by completion date to create a set of candidate polygon-groups. All other activities deemed to potentially affect tree cover were subtracted away from the candidates. See the @sec-usfsAct for a detailed description. This ensures that the only activity occurring in the selected area was "Thinning for hazardous fuel reduction." Other activities, such as "Commercial Thin" and "Precommercial Thin" may actually have been performed to improve the resilience of forests to frequent-fire patterns and climate change. This study serves as a pilot to test one particular area. Future studies would benefit from expanding the scope to include more thinning projects that have different activity designations.

The above criteria resulted in three sets of polygons, grouped by completion date. The largest, which was completed in September of 2014, was part of the Bluewater Ecosystem Management Project and is referred to as "D-2 BW Thinning." See @fig-context for an image which gives context for the location within the forest. This treatment was also found to have the most significant reduction in tree cover after thinning (see @fig-cover). This polygon is used for the remainder of the analysis.

![Zuñi Mountains forest polygon and selected thinning treatment. Thinning treatments shown here are all. in the category "Thinning for Hazardous Fuels Reduction", were completed between 2001 and 2014, and not in 2005 or 2010, and do not overlap any other treatment which was completed between 2000 and 2015 that could alter tree cover.](./GeneratedPlots/selectedThin_context.jpeg){#fig-context}

![Percent tree cover for the four years. 30x30 meter resolution. Note the significant reduction in tree cover between the years 2010 and 2015. TODO: set order of facets and be consistent across all figures.](./GeneratedPlots/percentTreeCover.jpeg){#fig-cover width="100%"}

Relative frequency histograms for each cover value, for the chosen polygon, are shown in @fig-hist. The dramatic shift in the peak from 2010 to 2015 indicates that overall the percent cover was reduced over that time period. Note that the maximum value for percent cover is 47% across all years. The average error for all cells with a particular cover value is by color in the plot. Error is RMSE in units of percent cover. The year 2015 has very low error, while the error is between 15% and 19% for previous years. Note that the unusually high occurrence of 0%, 39%, 45% cover cells in the year 2000, and 12% in 2010, do not show abnormally high average error. This indicates that, with respect to error, there is no explanation for the abnormalities.

![Relative frequency histograms of the percent cover. Colors indicate the average error for each cover class (0-100, integer values) (TODO: change order so 2015 is above 2010 for better comparison)](./GeneratedPlots/percentTreeCover_hist.jpeg){#fig-hist}

#### Increasing Resolution via Stochastic Simulation

In order to assess if a cell is optimal or not it is necessary to A) categorize cells as either bare ground or tree-cover and B) use cells that are smaller than the threshold distance of 15m. To avoid using arbitrarily small cells, Google Earth images of the Zuñi Mountains were used to characterize typical tree crown diameter sizes (see @sec-3x3Reasoning for images). Crown diameters were observed to typically range between 3 and 4 meters. Therefore, on the smaller end it can be assumed that a 3x3 meter cell is either bare ground, or completely covered by a tree. Based on this assumption a stochastic simulation was used to generate a 3x3 meter resolution image derived from the 30x30 meter percent-cover image.

The simulation works as follows: Each 30x30 meter cell is subdivided into 100 3x3 meter cells. Because there are 100 sub-cells per 30x30 meter cell, percent cover values translate directly to the number of covered sub-cells. This number of covered sub-cells is distributed randomly within the 30x30 cell. Therefore, the percent cover for the 30x30 cell is preserved. This operation is repeated for each 30x30 meter cell to convert the entire percent-tree-cover image into a simulated tree-cover distribution. This conversion is repeated 100 times for each year to create a spread of possible tree-cover distribution images. Note that clusters of 3x3m cells may be interpreted as multiple small trees or one large tree. See @fig-randExample for an example of one 30x30 meter cell being converted to 3x3 meter resolution via stochastic simulation. @fig-stochsim shows an entire stochastic simulation for the year 2000.

![An example of a random simulation of trees 30x30 meter cell with 30% tree cover. 0 Represents bare ground, 100 represents tree-cover. (TODO: convert to ground and tree levels, color accordingly)](./GeneratedPlots/one30x30randSim.jpeg){#fig-randExample fig-align="center" width="400"}

![An example of a stochastic simulation of tree cover distribution. The black square represents the zoomed area shown in @fig-zoom (TODO: rename to tree to tree-cover. a cluster of cells could represent one big tree)](./GeneratedPlots/OneStochasticSim_withZoom.jpeg){#fig-stochsim}

#### Definition Of Optimal Condition for Snowpack Accumulation

Snowpack data is unavailable at high enough resolutions to be useful. Therefore, it is necessary to assess the potential for the forest to accumulate snow based on forest structure alone. A previous study in the Jemez Mountains found that the optimal condition for snowpack accumulation was, on average, clear ground within 15 meters of tree cover [@broxton2015]. According to the study, snow that lands directly on trees is melted and evaporated more rapidly than snow that lands on the ground. Similarly, snow that falls on ground greater than 15 meters from tree cover is also melted, evaporated, or moved by the wind more rapidly than snow closer to tree cover. This approximation does not take into consideration the observed pattern that snow accumulated less on south-facing sides of trees in the Jemez Mountains [@broxton2015], suggesting that in that region solar irradiation has relatively large impact on snow accumulation. Inspection of Google Earth satellite imagery for the year 2014, to the immediate west of the chosen thinning project, reveals a strong pattern of snow accumulating to the north of tree cover (see @sec-visAsses). These observations are used to create criteria which classify bare ground as either optimal for snow accumulation or not. Because these criterion are simplified models of where snow will accumulate the best, we define multiple possible criterion and assess the impact of different criterion on the final result. Each criteria operates on the 3m x 3m simulated tree cover data, and asses whether a given bare-ground cell is optimal or not.

The chosen criteria are as follows:

##### Midday Shading Criterion: North Line

A bare ground cell is optimal if there is a cluster of tree cover within 15 meters to the south (measured from the southern most edge of the cell). This models snowpack as being primarily affected by midday sun exposure. The clusters of tree cover must be at or above a minimum threshold size. Thresholds considered here are 1 and 2 cells, which may be connected by an edge or by a corner. Setting the threshold to 2 cells effectively models small, isolated trees as ineffective for sheltering snow. The visual effect of this is each cluster having a line of snow to the north, hence the name North Line.

##### General Shading and Wind Shelter Criterion: North Semicircle

A bare ground cell is optimal when a half-circle area to the south, centered on the cell in question, contains at least a threshold area of tree cover. The radius of the half-circle is roughly 15meters (pixelation prevents an exact circle). Threshold areas are set to 1, 2, 3, 4, and 5 cells, respectively. This corresponds to 9, 18, 27, 36 and 45 m^2^ required covered area.

This criteria was developed based on the simple approximation from [@broxton2015a] which states that bare ground \<15m from canopy cover has more snow and more snow variability. The higher snow variability close to tree canopy is attributed to wind and sun effects, and an overall pattern of less snow on the southside of canopy cover was observed. Therefore this criterion only considers areas in a semicircle to the north. As the threshold area increases this criterion approaches a model which combines both a) shading accross a wider span of the day and b) protection from wind distribution. This is simply because as the threshold area increases it becomes more likely that cover exists to the south, east, and west, and anywhere in between. The visual effect of this is groups of trees having snow in a roughly half circle to the north, hence the name North Semicircle

TODO: image explaining both of these the optimality focal function

All criteria were applied to each of the 100 simulated images and across all years. A zoomed in image of each criterion applied to one stochastic simulation for the year 2015 is shown in @fig-zoom. TODO: make that image. possibly include 30x30 lines

![Simulated tree distributions and their resulting optimal cells (white), shown for three different simulations, for the year 2000. The area shown corresponds to the black square in @fig-stochsim. Note that sub-optimal area is distinguished between trees (green) and bare-ground \> 15m from tree cover (tan). TODO: text too small](./GeneratedPlots/zoom_sim_opt_compare.jpeg){#fig-zoom}

Finally, the total optimal area is calculated for each criterion applied to each simulation, across all years

A flow chart illustrating the process is shown below

```{mermaid}
flowchart TD
  X[choose a polygon] --> A[crop percent-cover by polygon]
  A --> B[generate 100 simulations for each: \nyear]
  B --> C[calculate optimal image for each:\ncriterion\nyear\nsimulation]
  C --> D[calculate total optimal area for each:\ncriterion\nyear\nsimulation]
```

## Results

All total optimal areas for each criterion are shown in @fig-totOptArea. All criteria except North Semicircle with minimum threshold of 1 and 2 covered cells, respectively, result in a reduction of total optimal area after the 2014 thinning treatment. As the minimum number of covered cells increases for the North Semicircle criterion the overall total optimal area decreases, across all years. Not only that, the magnitude of the decrease in total optimal area after the thinning treatment *increases*. This can be visualized in @fig-totOptArea as the slope of the lines between the years 2010 and 2015, which increases with increasing minimum number of covered cells. For the North Line criteria the total optimal area across all years decreases as minimum cluster size goes from 1 to 2 cells. The slope of the lines between years 2010 and 2015 also increases as minimum cluster size increases.

The variation within each year, for all criterion, is small relative to the variation between years. This can be seen in @fig-totOptArea as the relatively small deviations from a straight line in each colored bar. Each simulation is plotted as a dot with some transparency. All the dots for a given year-criterion pair are randomly distributed on a horizontal span. This visualizes the variation between simulations as deviations from a straight line. Variation between simulations, isolated by year, is visualized in @fig-totOptAreaSep. Note that this variation comes only from sub-optimal bare ground, because the number of covered cells is always the same between simulations.

The total extent of the thinning polygon is 3.24 km^2^.

![Total Optimal Area for all simulation. Each simulation's optimal area is represented by a dot with a different horizontal position. All the dots cluster very tightly relative to the variation between years, making the vertical difference between dots for one year nearly imperceptible. Lines are shown to help visualize the relative magnitude of change between criteria.](./GeneratedPlots/totOpt_all.jpeg){#fig-totOptArea}

![Total optimal area using the North Line criteria with minimum cluster size of 1, isolated by year to visualize the within-year variation due to the 100 stochastic simulations. Note the different y-axis ranges. Each data point is slightly translucent and randomly aligned horizontally to allow a direct visualization of the distribution. Black lines are kernel density plots as an alternate view of the distribution.](./GeneratedPlots/c1_inYarVar.jpeg){#fig-totOptAreaSep}

| year   | average optimal area (km^2^) | percent optimal area | range optimal area (km^2^) | range optimal area (m^2^) |
|:--------------|--------------:|--------------:|--------------:|--------------:|
| yr2000 |                         2.44 |                 75.2 |                     0.0023 |                      2304 |
| yr2005 |                         2.52 |                 77.7 |                     0.0013 |                      1314 |
| yr2010 |                         2.48 |                 76.6 |                     0.0015 |                      1548 |
| yr2015 |                         2.90 |                 89.5 |                     0.0037 |                      3726 |

: Summary of Total Optimal Area {#tbl-results}

## Discussion

The prediction was that the D-2 treatment within the Bluewater Ecosystem Management Project would create large clearings between trees, and therefore reduce the snow accumulation potential of the forest. The results confirm the prediction. All of the criterion that are reasonable models of snowpack accumulation result in a reduction of optimal area after thinning. The consistency of this result under different criterion adds support to the hypothesis.

Although two of the seven criterion result in an *increase* in optimal area after thinning, those criterion are not realistic models and should be discounted. The unrealistic criteria result from the North Semicircle criteria with minimum number of covered cells set to 1 (9m^2^) and 2 (18 m^2^), respectively. These criteria effectively model snowpack as occurring in a semicircle around one or two small trees, even if they stand alone in a large clearing. No evidence of such a pattern is found in Google Earth imagery. Instead, snow appears on the north side of canopy cover, not in a semicircle ranging from east to west. The North Semicircle criteria with the threshold set to 4 or 5 cells is a better model of this pattern. At these threshold values it is more likely that an area designated as optimal will be to the north of tree cover, as well as protected by tree cover in other directions. These more realistic criteria result in a confirmation of the prediction (@fig-totOptArea, North Semicircle data, thresholds 4-5).

The simplest model based on visual evidence from Google Earth represents snowpack as occurring on the north side of tree cover (North Line criteria) (see @sec-visAsses, North Line data). Both the generous (minimum cluster size set to 1 cell) and more conservative (minimum cluster size set to 2 cells) versions of this criteria result in a reduction in optimal area after thinning.

There is relatively small variation in total optimal area between stochastic simulations for the same year and criteria (see range columns in @tbl-results #TODO: fix table or don't use it). One possible explanation is as follows. For a particular criteria, specific spatial configurations will affect total optimal area. For example, the North Lines criteria with minimum cluster size set to 1 will have highest optimal area when tree cover is arranged in lines spaced at 15 meter intervals, running east to west. Similarly, lowest optimal area will occur when all the tree cover cells are bunched together in a north-south oriented oblong cluster. While there may be some relatively high probability of these extremes occurring for one 30mx30m cell, the probability that one of these extremes (high or low) occur for all 3,602 cells in the study area is low. In other words, extreme results cancel each other out at a sufficiently large spatial scale. A future study investigating the effect of spatial scale on these results would be required to prove this. This line of reasoning does not consider that the probabilities of extremes are bounded by, and depend on, percent cover values.

TODO: INCLUDE THIS:??? If this is true, that differences in spatial structure tend to cancel each other out a sufficiently large areas, it may be possible to predict changes in snowpack accumulation potential from tree cover density alone.

#### Limitations

Observation of google earth imagery suggests that two important missing factors for snow accumulation are aspect and elevation. Although less common, some clusters of tree cover did not have snow to the north, while some areas of bare ground greater than 15m from tree cover did have snow. This suggests that other factors impact snow accumulation in this area. A clear large scale pattern of more snow on the north faces, and closer to the major ridge of the Zuñi Mountains, suggests that the missing factors are aspect and elevation. A future study that incorporates these factors will likely create better approximations of snow accumulation potential.

Ultimately true snowpack spatial patterns are unknown. This study only investigates the *potential* of an area to accumulate snow.

This study simulates tree cover distribution at sub 30 meter spatial scales with randomness. In reality there are likely non-random spatial distributions at these scales. Including models of non-random or psuedo-random distributions in the simulations could increase the realism. Alternatively, applying the various optimality criterion to true tree cover distributions will greatly increase the certainty of the conclusion.

This study concludes that the optimal area decreased for the region of interest. However, the magnitudes of optimal area should only be used to interpret changes in optimal area. The true magnitudes of optimal area are unknown. Note the drastic changes in magnitude due to choice of criteria in @fig-totOptArea.

## Conclusions

For the D-2 Bluewater thinning project the snowpack accumulation potential decreased after thinning. This suggests that the potential for that forest area to integrate water into the soil has decreased. This conclusion is based on a previous studies' modeled results, which showed that bare ground within 15m of tree cover has higher net snow water input than both tree-covered areas and bare ground greater than 15m from tree cover[@broxton2015a]. While the present study focuses on the most extreme change in tree cover, a similar method may be applied to other treatments that correspond to less drastic changes in cover. Optimal area for snowpack accumulation results in a balance between tree cover and bare ground. Therefore it is possible that other treatments will be found to increase total optimal area.

## Technical Appendices

### Code Repository

All analyses were performed using R Statistical Software (v4.2.1; R Core Team 2022). The R package Terra was used for raster manipulations necessary in this analysis.

TODO: put link to github repo

### Classification of USFS Activities {#sec-usfsAct}

Data was accessed though [@activitia]. The following activities are assumed to have no effect on tree cover:

```{r echo=FALSE, include=TRUE}
print(NO_ALTER_TC, row.names=FALSE)
```

### Arriving at the 3-meter minimum cell size {#sec-3x3Reasoning}

My apologies, I plan to redo this analysis to check the 3x3 meter assumption is valid. Google Earth imagery from the years \_\_ \_\_\_ and \_\_\_ within the Zuni Mountains were visually inspected in n=\_\_\_ locations. At each location an area of \_\_ m^2^ was observed to create an impression of a the range in tree crown diameter. Then small and large tree crowns were respectively measured using google-earth's measurement tool.

The following table shows the resulting crown diameters:

The following image shows selected areas:

### Visual Assessment of Snow Accumulation Patterns {#sec-visAsses}

### Comparing to Real Imagery

::: {#fig-yr2015 layout-ncol="2"}
![img](./GeneratedPlots/2015-03-25_googleEarth.png){#fig-google}

![cow](./GeneratedPlots/simImg2015.jpeg)
:::

### Randomness Validation

In order to verify that the stochastic simulations are indeed random and are representative of the original percent tree-cover data, all the simulation layers were reclassified so that a covered cell had the value 1/100. Then all 100 layers were summed, giving a visual impression of the randomness and a way to compare all the simulations to the original data. If a particular cell was always covered by a tree, the resulting summed image would result in a pixel value of 1. Because percent-cover values never go above 50 a pixel value of 1 should never be observed in the summed simulation image, which is indeed the case. The results are below in @fig-alphasims. For convenience the original percent cover images are included below (@fig-again). Note that the summed image appears to well approximate the original cover image, as expected.

![Summed simulations (n=100), where simulation cover values are set to 1/100, bare ground is 0. The zoomed area is represented on the left by a white square.](./GeneratedPlots/simsSummedAlpha.jpeg){#fig-alphasims}

![Percent tree cover for the four years. 30x30 meter resolution. Note the significant reduction in tree cover between the years 2010 and 2015.](./GeneratedPlots/percentTreeCover.jpeg){#fig-again}

## References

::: {#refs}
:::
